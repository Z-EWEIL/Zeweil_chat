<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ù…ØªØ¬Ø± Ø§Ù„Ø±ØªØ¨ - ZEWEIL Chat</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: Tahoma, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h2 {
      color: #0f0;
      margin-bottom: 20px;
    }
    .rank-card {
      background: linear-gradient(145deg, #1a1a1a, #222);
      border-radius: 10px;
      padding: 15px;
      margin: 10px;
      width: 300px;
      text-align: center;
      box-shadow: 0 0 10px #0f0;
      transition: transform 0.2s ease;
    }
    .rank-card:hover {
      transform: scale(1.05);
    }
    .rank-img {
      width: 50px;
      height: 50px;
      margin-bottom: 10px;
    }
    .rank-name {
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    .rank-price {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: #afa;
    }
    button.buy-btn {
      background-color: #0f0;
      border: none;
      padding: 10px 20px;
      color: black;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button.buy-btn:hover:not(:disabled) {
      background-color: #9f9;
    }
    button.buy-btn:disabled {
      background-color: #555;
      cursor: not-allowed;
    }
    #pointsDisplay {
      margin-bottom: 20px;
      font-size: 1.2em;
      color: #afa;
    }
  </style>
</head>
<body>
  <h2>ğŸ–ï¸ Ù…ØªØ¬Ø± Ø§Ù„Ø±ØªØ¨ - ZEWEIL Chat</h2>
  <div id="pointsDisplay">Ø±ØµÙŠØ¯Ùƒ: 0 ğŸ¯</div>
  <div id="ranksContainer"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAlim9FOvDcMqTJWINoBCHk3k6DNXS-jTo",
      authDomain: "zeweil-chat.firebaseapp.com",
      databaseURL: "https://zeweil-chat-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "zeweil-chat",
      storageBucket: "zeweil-chat.appspot.com",
      messagingSenderId: "79843372176",
      appId: "1:79843372176:web:ea511efffae60c2a6cfc15"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let userId = null;
    let currentPoints = 0;
    let currentRank = null;

    // Ø±Ø§Ø¨Ø· ØµÙˆØ± Ø§Ù„Ø¨Ø§Ø¯Ø¬Ø§Øª Ø¹Ù„Ù‰ GitHub
    const baseImageUrl = "https://raw.githubusercontent.com/Z-EWEIL/Zeweil_chat/main/";

    const ranks = [
      { id: "beginner", name: "Ù…Ø¨ØªØ¯Ø¦", price: 100, img: "beginner.png" },
      { id: "intermediate", name: "Ù…ØªÙˆØ³Ø·", price: 250, img: "intermediate.png" },
      { id: "expert", name: "Ø®Ø¨ÙŠØ±", price: 500, img: "expert.png" },
      { id: "professional", name: "Ù…Ø­ØªØ±Ù", price: 1000, img: "professional.png" },
      { id: "pro", name: "Ø¨Ø±ÙˆÙØ´ÙŠÙ†Ø§Ù„", price: 2000, img: "pro.png" },
      { id: "Z", name: "Ø±ØªØ¨Ø© Z (Ø¥Ø¯Ø§Ø±ÙŠØ©)", price: 9999999, img: "Z.png", adminOnly: true }
    ];

    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        userId = user.uid;
        loadUserData();
      } else {
        firebase.auth().signInAnonymously().catch(console.error);
      }
    });

    function loadUserData() {
      db.ref(`users/${userId}`).once("value").then(snapshot => {
        const data = snapshot.val() || {};
        currentPoints = data.points || 0;
        currentRank = data.rank || null;
        updatePointsDisplay();
        renderRanks();
      });
    }

    function updatePointsDisplay() {
      document.getElementById("pointsDisplay").textContent = `Ø±ØµÙŠØ¯Ùƒ: ${currentPoints} ğŸ¯`;
    }

    function renderRanks() {
      const container = document.getElementById("ranksContainer");
      container.innerHTML = "";

      ranks.forEach(rank => {
        if (rank.adminOnly) return;

        const card = document.createElement("div");
        card.className = "rank-card";

        card.innerHTML = `
          <img class="rank-img" src="${baseImageUrl + rank.img}" alt="${rank.name}">
          <div class="rank-name">${rank.name}</div>
          <div class="rank-price">${rank.price} Ù†Ù‚Ø§Ø·</div>
          <button class="buy-btn" ${currentRank === rank.id ? "disabled" : ""}>
            ${currentRank === rank.id ? "ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡" : "Ø´Ø±Ø§Ø¡"}
          </button>
        `;

        const btn = card.querySelector(".buy-btn");
        btn.onclick = () => {
          if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø´Ø±Ø§Ø¡ Ø±ØªØ¨Ø© ${rank.name}ØŸ`)) {
            buyRank(rank);
          }
        };

        container.appendChild(card);
      });
    }

    function buyRank(rank) {
      if (currentRank === rank.id) {
        alert("â— Ù„Ø¯ÙŠÙƒ Ù‡Ø°Ù‡ Ø§Ù„Ø±ØªØ¨Ø© Ø¨Ø§Ù„ÙØ¹Ù„.");
        return;
      }
      if (currentPoints < rank.price) {
        alert("âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ù†Ù‚Ø§Ø· ÙƒØ§ÙÙŠØ©.");
        return;
      }

      const updates = {};
      updates[`users/${userId}/points`] = currentPoints - rank.price;
      updates[`users/${userId}/rank`] = rank.id;

      db.ref().update(updates).then(() => {
        alert(`âœ… ØªÙ… Ø´Ø±Ø§Ø¡ Ø±ØªØ¨Ø© ${rank.name} Ø¨Ù†Ø¬Ø§Ø­!`);
        currentPoints -= rank.price;
        currentRank = rank.id;
        updatePointsDisplay();
        renderRanks();
      }).catch(err => {
        console.error(err);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø´Ø±Ø§Ø¡.");
      });
    }
  </script>
</body>
</html>
