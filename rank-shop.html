<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ù…ØªØ¬Ø± Ø§Ù„Ø±ØªØ¨ - ZEWEIL Chat</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: Tahoma, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h2 {
      color: #0f0;
      margin-bottom: 20px;
    }
    .rank-card {
      background: #222;
      border-radius: 10px;
      padding: 15px;
      margin: 10px;
      width: 300px;
      text-align: center;
      box-shadow: 0 0 10px #0f0;
    }
    .rank-name {
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    .rank-price {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: #afa;
    }
    button.buy-btn {
      background-color: #0f0;
      border: none;
      padding: 10px 20px;
      color: black;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button.buy-btn:disabled {
      background-color: #555;
      cursor: not-allowed;
    }
    #pointsDisplay {
      margin-bottom: 20px;
      font-size: 1.2em;
      color: #afa;
    }
  </style>
</head>
<body>
  <h2>ğŸ–ï¸ Ù…ØªØ¬Ø± Ø§Ù„Ø±ØªØ¨ - ZEWEIL Chat</h2>
  <div id="pointsDisplay">Ø±ØµÙŠØ¯Ùƒ: 0 ğŸ¯</div>
  <div id="ranksContainer"></div>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAlim9FOvDcMqTJWINoBCHk3k6DNXS-jTo",
      authDomain: "zeweil-chat.firebaseapp.com",
      databaseURL: "https://zeweil-chat-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "zeweil-chat",
      storageBucket: "zeweil-chat.appspot.com",
      messagingSenderId: "79843372176",
      appId: "1:79843372176:web:ea511efffae60c2a6cfc15"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let userId = null;
    let currentPoints = 0;
    let currentRank = null;

    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø±ØªØ¨ ÙˆØ£Ø³Ø¹Ø§Ø±Ù‡Ø§
    const ranks = [
      { id: "beginner", name: "Ù…Ø¨ØªØ¯Ø¦", price: 100 },
      { id: "intermediate", name: "Ù…ØªÙˆØ³Ø·", price: 250 },
      { id: "expert", name: "Ø®Ø¨ÙŠØ±", price: 500 },
      { id: "professional", name: "Ù…Ø­ØªØ±Ù", price: 1000 },
      { id: "pro", name: "Ø¨Ø±ÙˆÙØ´ÙŠÙ†Ø§Ù„", price: 2000 },
      { id: "Z", name: "Ø±ØªØ¨Ø© Z (Ø¥Ø¯Ø§Ø±ÙŠØ©)", price: 9999999, adminOnly: true }
    ];

    // Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø´ÙƒÙ„ Ù…Ø¬Ù‡ÙˆÙ„ (Ø£Ùˆ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ uid Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ)
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        userId = user.uid;
        loadUserData();
      } else {
        firebase.auth().signInAnonymously().catch(console.error);
      }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù†Ù‚Ø§Ø· ÙˆØ±ØªØ¨Ø©)
    function loadUserData() {
      db.ref(`users/${userId}`).once("value").then(snapshot => {
        const data = snapshot.val() || {};
        currentPoints = data.points || 0;
        currentRank = data.rank || null;
        updatePointsDisplay();
        renderRanks();
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯
    function updatePointsDisplay() {
      document.getElementById("pointsDisplay").textContent = `Ø±ØµÙŠØ¯Ùƒ: ${currentPoints} ğŸ¯`;
    }

    // Ø±Ø³Ù… ÙƒØ±ÙˆØª Ø§Ù„Ø±ØªØ¨
    function renderRanks() {
      const container = document.getElementById("ranksContainer");
      container.innerHTML = "";

      ranks.forEach(rank => {
        // Ø¥Ø°Ø§ Ø±ØªØ¨Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ø§ ØªØ¸Ù‡Ø± Ù‡Ù†Ø§
        if (rank.adminOnly) return;

        const card = document.createElement("div");
        card.className = "rank-card";

        card.innerHTML = `
          <div class="rank-name">${rank.name}</div>
          <div class="rank-price">${rank.price} Ù†Ù‚Ø§Ø·</div>
          <button class="buy-btn" ${currentRank === rank.id ? "disabled" : ""}>${currentRank === rank.id ? "ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡" : "Ø´Ø±Ø§Ø¡"}</button>
        `;

        // Ø²Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
        const btn = card.querySelector(".buy-btn");
        btn.onclick = () => buyRank(rank);

        container.appendChild(card);
      });
    }

    // Ø´Ø±Ø§Ø¡ Ø±ØªØ¨Ø©
    function buyRank(rank) {
      if (currentRank === rank.id) {
        alert("â— Ù„Ø¯ÙŠÙƒ Ù‡Ø°Ù‡ Ø§Ù„Ø±ØªØ¨Ø© Ø¨Ø§Ù„ÙØ¹Ù„.");
        return;
      }
      if (currentPoints < rank.price) {
        alert("âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ù†Ù‚Ø§Ø· ÙƒØ§ÙÙŠØ©.");
        return;
      }

      // Ø®ØµÙ… Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØªØ¨Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      const updates = {};
      updates[`users/${userId}/points`] = currentPoints - rank.price;
      updates[`users/${userId}/rank`] = rank.id;

      db.ref().update(updates).then(() => {
        alert(`âœ… ØªÙ… Ø´Ø±Ø§Ø¡ Ø±ØªØ¨Ø© ${rank.name} Ø¨Ù†Ø¬Ø§Ø­!`);
        currentPoints -= rank.price;
        currentRank = rank.id;
        updatePointsDisplay();
        renderRanks();
      }).catch(err => {
        console.error(err);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø´Ø±Ø§Ø¡.");
      });
    }
  </script>
</body>
</html>
