<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±Ù - ZEWEIL Chat</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body { background: #111; color: white; font-family: Tahoma; padding: 20px; }
    h2 { color: #0f0; }
    button { padding: 8px; margin: 5px; border: none; border-radius: 5px; background: #0f0; color: #000; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #333; padding: 10px; text-align: center; }
    th { background: #222; }
  </style>
</head>
<body>
  <h2>ğŸ› ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±Ù - ZEWEIL Chat</h2>
  <button onclick="loadRooms()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØºØ±Ù</button>
  <table>
    <thead>
      <tr>
        <th>Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
      </tr>
    </thead>
    <tbody id="roomTable"></tbody>
  </table>

  <script>
    const firebaseConfig = {
      databaseURL: "https://zeweil-chat-default-rtdb.europe-west1.firebasedatabase.app/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function loadRooms() {
      const table = document.getElementById("roomTable");
      table.innerHTML = "";

      db.ref("rooms").once("value", snapshot => {
        snapshot.forEach(child => {
          const roomName = child.key;
          const room = child.val();

          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${roomName}</td>
            <td>${room.active ? "Ù…ÙØªÙˆØ­Ø©" : "Ù…Ù‚ÙÙˆÙ„Ø©"}</td>
            <td>
              <button onclick="toggleRoom('${roomName}', ${room.active})">
                ${room.active ? "ğŸ›‘ Ø¥Ù‚ÙØ§Ù„ Ø§Ù„ØºØ±ÙØ©" : "âœ… ÙØªØ­ Ø§Ù„ØºØ±ÙØ©"}
              </button>
              <button onclick="sendSystemMessage('${roomName}')">ğŸ“¢ Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…</button>
              <button onclick="deleteRoomMessages('${roomName}')">ğŸ—‘ï¸ Ø­Ø°Ù Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØºØ±ÙØ©</button>
            </td>
          `;
          table.appendChild(row);
        });
      });
    }

    function toggleRoom(roomName, isActive) {
      db.ref(`rooms/${roomName}`).update({ active: !isActive })
        .then(() => {
          alert(`ØªÙ… ${isActive ? "Ø¥Ù‚ÙØ§Ù„" : "ÙØªØ­"} Ø§Ù„ØºØ±ÙØ©: ${roomName}`);
          loadRooms();
        })
        .catch(() => alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ØºØ±ÙØ©"));
    }

    function sendSystemMessage(roomName) {
      const message = prompt(`Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ ØºØ±ÙØ© "${roomName}":`);
      if (!message) return;

      db.ref(`rooms/${roomName}/messages`).push({
        name: "ğŸš¨ Ø§Ù„Ù†Ø¸Ø§Ù…",
        message: message,
        time: new Date().toLocaleTimeString(),
        system: true
      })
      .then(() => alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­"))
      .catch(() => alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…"));
    }

    function deleteRoomMessages(roomName) {
      if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø±Ø³Ø§Ø¦Ù„ ØºØ±ÙØ©: ${roomName}ØŸ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§!`)) {
        return;
      }
      db.ref(`rooms/${roomName}/messages`).remove()
        .then(() => alert(`âœ… ØªÙ… Ø­Ø°Ù ÙƒÙ„ Ø±Ø³Ø§Ø¦Ù„ ØºØ±ÙØ© ${roomName}`))
        .catch(() => alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„"));
    }
  </script>
</body>
</html>
