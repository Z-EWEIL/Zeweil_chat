<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8" />
    <title>لوحة الصدارة</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body {
            background-color: #111;
            color: white;
            font-family: Tahoma;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            color: #ffc107;
            text-align: center;
        }
        #leaderboard {
            width: 90%;
            max-width: 600px;
            background: #1a1a1a;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .rank-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #333;
            transition: background-color 0.3s ease;
        }
        .rank-item:hover {
            background-color: #222;
        }
        .rank-position {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffc107;
            width: 40px;
            text-align: center;
        }
        .rank-info {
            flex-grow: 1;
            margin-left: 10px;
        }
        .rank-name {
            font-size: 1.2em;
            color: #0f0;
            font-weight: bold;
        }
        .rank-details {
            font-size: 0.9em;
            color: #aaa;
        }
        img.rank-icon {
            width: 40px;
            height: 40px;
            margin-left: 10px;
        }
        #backButton {
            position: fixed;
            top: 15px;
            right: 15px;
            background-color: #0f0;
            color: black;
            font-size: 24px;
            padding: 10px 14px;
            border-radius: 50%;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        #backButton:hover {
            background-color: #0c0;
        }
    </style>
</head>
<body>
    <a href="https://dulcet-lily-7804e3.netlify.app/" id="backButton" title="العودة للدردشة">🏠</a>

    <h1>🏆 لوحة الصدارة</h1>
    <div id="leaderboard"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAlim9FOvDcMqTJWINoBCHk3k6DNXS-jTo",
            authDomain: "zeweil-chat.firebaseapp.com",
            databaseURL: "https://zeweil-chat-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "zeweil-chat",
            storageBucket: "zeweil-chat.appspot.com",
            messagingSenderId: "79843372176",
            appId: "1:79843372176:web:ea511efffae60c2a6cfc15",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function getRankImg(rank) {
            if (!rank) return "";
            const baseRaw = "https://raw.githubusercontent.com/Z-EWEIL/Zeweil_chat/main/";
            const filename = `${rank}.png`;
            return `<img src="${baseRaw}${filename}" alt="${rank}" class="rank-icon" />`;
        }
        
        function getRankValue(rank) {
            const ranks = {
                "beginner": 1,
                "amateur": 2,
                "pro": 3,
                "master": 4,
                "king": 5,
                "queen": 5
            };
            return ranks[rank.toLowerCase()] || 0;
        }

        function loadLeaderboard() {
            const leaderboardDiv = document.getElementById("leaderboard");
            leaderboardDiv.innerHTML = "";
            db.ref("users").orderByChild("points").limitToLast(100).once("value", (snapshot) => {
                const users = [];
                snapshot.forEach((child) => {
                    const userData = child.val();
                    users.push(userData);
                });
                // فرز المستخدمين بناءً على النقاط (تنازلي) ثم الرتبة (تنازلي)
                users.sort((a, b) => {
                    if ((b.points || 0) !== (a.points || 0)) {
                        return (b.points || 0) - (a.points || 0);
                    }
                    return getRankValue(b.rank) - getRankValue(a.rank);
                });
                // هذا هو الجزء الذي كان مفقودًا أو تم حذفه عن طريق الخطأ
                users.reverse(); 

                users.forEach((user, index) => {
                    const rankItem = document.createElement("div");
                    rankItem.classList.add("rank-item");
                    const userRank = user.rank || "beginner";
                    const rankImg = getRankImg(userRank);
                    rankItem.innerHTML = `
                        <span class="rank-position">#${index + 1}</span>
                        <div class="rank-info">
                            <div class="rank-name">${user.name || "مستخدم مجهول"}</div>
                            <div class="rank-details">
                                النقاط: ${user.points || 0} 🎯 | الرتبة: ${userRank}
                            </div>
                        </div>
                        ${rankImg}
                    `;
                    leaderboardDiv.appendChild(rankItem);
                });
            });
        }
        loadLeaderboard();
    </script>
</body>
</html>
